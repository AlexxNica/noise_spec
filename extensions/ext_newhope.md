---
title:      'Noise Extension: New Hope'
author:     'Rhys Weatherley (rhys.weatherley@gmail.com)'
revision:   '1draft-2'
date:       '2016-09-25'
---

1. Introduction
===============

This document describes the post-quantum key exchange algorithm New Hope
and provides information for using it with the Noise protocol.

New Hope [1] is a Diffie-Hellman like key exchange mechanism based on the
Ring Learning with Errors (Ring-LWE) problem.  It is believed to be
secure against an adversary with a quantum computer.  It provides the
equivalent of 128 bits of security.

New Hope is unusual in that its key sizes and operations vary based on
the party:

 * Alice generates a 1824-byte public key and a 2048-byte private key.
   Her 1824-byte public key is sent to Bob.
 * Bob uses Alice's public key to generate his own 2048-byte public key
   and a 32-byte shared secret.  His 2048-byte public key is sent to Alice.
 * Alice uses her 2048-byte private key and Bob's 2048-byte public key
   to generate her copy of the 32-byte shared secret.

New Hope supports ephemeral key exchange only, which makes it suitable
for use with the separate "Hybrid Forward Secrecy" extension to Noise.
While New Hope could be used as a regular DH function with the `NN`
pattern, we do not define that here.

2. Definition of `NewHope` for use in Noise
===========================================

The reference implementation of New Hope [2] has two variants, which it
refers to as "ref" and "torref".  They differ in the generation of
the public "a" value of the algorithm.  The "torref" variant uses a
constant-time algorithm to generate "a".

This document standardizes the "torref" variant under the Noise
function name `NewHope`.  The "ref" variant is not used.  The
function and constant definitions for hybrid forward secrecy are
as follows:

 * `**GENERATE_KEYPAIR_F()**`: Returns the result of `newhope_keygen()`
   which has the two components `private_key` and `public_key`.

 * `**GENERATE_KEYPAIR_G(r)**`: Returns the result of `newhope_sharedb()`
   which has the two components `shared` and `public_key`.

 * `**MIX_FG(key_pair, public_key)**`: If `key_pair` was generated by
   `GENERATE_KEYPAIR_F()`, then return the result of
   `newhope_shareda(key_pair.private_key, public_key)`.  Otherwise
   return `key_pair.shared` and ignore `public_key`.

 * `FLEN` = 1824

 * `GLEN` = 2048

 * `FGLEN` = 32

3. Test vector definition
=========================

The Noise test vector format assumes that fixed ephemeral keys can be
set using only their private key.  However, the New Hope API does not
expose a private key in the same sense as `25519` and `448`.

The reference implementation of New Hope acquires 64 bytes of random
seed data from the system to generate the key pair for Alice and the
public "a" value.  The reference implementation acquires 32 bytes of
random seed data from the system to generate the key pair for Bob
relative to "a".

The 64 or 32 bytes of random seed data can be used as the "private key"
component for ephemeral keys in test vectors.

4. Examples
===========

The following are examples of protocol names involving New Hope:

 * `Noise_XXhfs_25519+NewHope_AESGCM_SHA256`
 * `Noise_XXfallback+hfs_448+NewHope_ChaChaPoly_BLAKE2b`

5. References
=============

[1] Erdem Alkim, Léo Ducas, Thomas Pöppelmann, and Peter Schwabe:
[Post-quantum key exchange – a new hope](https://cryptojedi.org/papers/#newhope).
Proceedings of the 25th USENIX Security Symposium.

[2] [Reference implementation of New Hope](https://cryptojedi.org/crypto/#newhope).
